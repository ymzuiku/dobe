var P=Object.defineProperty,b=Object.defineProperties;var p=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var T=(t,r,e)=>r in t?P(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,h=(t,r)=>{for(var e in r||(r={}))I.call(r,e)&&T(t,e,r[e]);if(y)for(var e of y(r))R.call(r,e)&&T(t,e,r[e]);return t},d=(t,r)=>b(t,p(r));var m=(t,r,e)=>new Promise((n,o)=>{var i=s=>{try{f(e.next(s))}catch(u){o(u)}},a=s=>{try{f(e.throw(s))}catch(u){o(u)}},f=s=>s.done?n(s.value):Promise.resolve(s.value).then(i,a);f((e=e.apply(t,r)).next())});var A=t=>(r,e)=>(r.method==="GET"?t.get(r.url,n=>r(n.query,e)):t[r.method.toLocaleLowerCase()](r.url,n=>r(JSON.parse(n.body),e)),e);function O(t){let r=t.status;return r>=200&&r<=299?t.json():t.json().then(e=>{throw typeof e=="object"?e.message?new Error(e.message):e:new Error(e)})}var c=(t,r,e)=>{let n=h({method:r.method},e);if(r.method==="GET"){let o=new URLSearchParams(t).toString();return fetch(c.baseURL+r.url+"?"+o,n).then(O)}return fetch(c.baseURL+r.url,d(h({},n),{body:JSON.stringify(t)})).then(O)};c.baseURL="";var w=(t,r)=>m(void 0,null,function*(){return yield t.validate(r),t.cast(r,{stripUnknown:!0})});var C=({method:t,requestSchema:r,responseSchema:e,url:n})=>{let o=(i,a,f)=>m(void 0,null,function*(){if(a=a||l.baseFetcher,!a)throw new Error("Not found fetcher: "+o.url);if(r)try{i=yield Promise.resolve(l.baseDtoValidate(r,i))}catch(u){throw l.onRequireError(u),u}let s=yield a(i,o,f);return e?l.baseDtoValidate(e,s):s});return o.requestSchema=r,o.responseSchema=e,o.url=n,o.method=t,o.TypeOfRequest={},o.TypeOfResponse={},o},E=(t,r,e)=>{if(e=e||l.baseController,!e)throw new Error("Not found controller: "+t.url);return e(t,r)},l={api:C,use:E,baseDtoValidate:w,baseFetcher:c,onRequireError:t=>{},baseController:void 0};export{A as createFastifyController,l as dobe,c as fetcher};
